<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sehat Sethu - Ultimate Health Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- Root Variables for Advanced Theming --- */
        :root {
            /* Light Theme Colors */
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --sidebar-bg: #ffffff;
            --sidebar-hover: #f1f5f9;
            --sidebar-active: #3b82f6;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --border-light: #e2e8f0;
            --border-medium: #cbd5e1;
            --accent-primary: #3b82f6;
            --accent-secondary: #10b981;
            --accent-danger: #ef4444;
            --accent-warning: #f59e0b;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
        }

        .dark-theme {
            /* Dark Theme Colors */
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --sidebar-bg: #1e293b;
            --sidebar-hover: #334155;
            --sidebar-active: #3b82f6;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --border-light: #334155;
            --border-medium: #475569;
            --accent-primary: #3b82f6;
            --accent-secondary: #10b981;
            --accent-danger: #ef4444;
            --accent-warning: #f59e0b;
        }

        /* --- Global Styles --- */
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            transition: all 0.3s ease;
            overflow-x: hidden;
        }

        /* --- Advanced Sidebar --- */
        /* Sidebar default */
.sidebar {
  width: 220px;
  transition: width 0.3s ease;
  overflow: hidden;
}

/* Collapsed sidebar */
.sidebar.collapsed {
  width: 60px;
}

/* Sidebar text fades out when collapsed */
.sidebar .sidebar-item span,
.sidebar h1 {
  opacity: 1;
  transition: opacity 0.2s ease;
  white-space: nowrap;
}

.sidebar.collapsed .sidebar-item span,
.sidebar.collapsed h1 {
  opacity: 0;
  pointer-events: none;
}

/* Align icons to center when collapsed */
.sidebar.collapsed .sidebar-item i {
  margin-right: 0;
  text-align: center;
  width: 100%;
}

/* Main content shifts */
.main-content {
  margin-left: 220px;
  transition: margin-left 0.3s ease;
}

.main-content.collapsed {
  margin-left: 60px;
}

        .sidebar {
            width: 280px;
            background-color: var(--sidebar-bg);
            border-right: 1px solid var(--border-light);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 1000;
            transition: all 0.3s ease;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background-color: var(--border-medium);
            border-radius: 3px;
        }

        .sidebar.collapsed {
            width: 80px;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sidebar-header .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .sidebar-header .logo img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .sidebar-header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
            color: var(--text-primary);
            transition: opacity 0.3s ease;
        }

        .sidebar.collapsed .sidebar-header h1 {
            opacity: 0;
            width: 0;
            overflow: hidden;
        }

        .sidebar-toggle {
        
            /* Keep toggle always visible when collapsed */
            .sidebar.collapsed .sidebar-toggle {
            position: absolute;
            right: 10px;
            top: 10px;
            z-index: 1010; /* above sidebar content */
            }
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
        }

        .sidebar-toggle:hover {
            background-color: var(--sidebar-hover);
            color: var(--text-primary);
        }

        .sidebar-menu {
            padding: 1rem 0;
            list-style: none;
            margin: 0;
        }

        .sidebar-menu li {
            margin: 0.25rem 0;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.2s ease;
            border-radius: 0;
            position: relative;
        }

        .sidebar-menu a i {
            width: 20px;
            text-align: center;
            margin-right: 0.75rem;
            font-size: 1.1rem;
        }

        .sidebar-menu a:hover {
            background-color: var(--sidebar-hover);
            color: var(--text-primary);
        }

        .sidebar-menu a.active {
            background-color: var(--sidebar-active);
            color: white;
            font-weight: 500;
        }

        .sidebar-menu a.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background-color: var(--accent-secondary);
        }

        .sidebar.collapsed .sidebar-menu a span {
            opacity: 0;
            width: 0;
            overflow: hidden;
        }

        .sidebar.collapsed .sidebar-menu a i {
            margin-right: 0;
        }

        /* --- Wellness Tips Card --- */
        .wellness-tips {
            margin: 1rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 1rem;
            color: white;
            text-align: center;
            box-shadow: var(--shadow-md);
        }

        .wellness-tips h4 {
            margin: 0 0 0.75rem 0;
            font-size: 1rem;
            font-weight: 600;
        }

        .wellness-tips p {
            margin: 0;
            font-size: 0.875rem;
            opacity: 0.9;
            line-height: 1.5;
        }

        .sidebar.collapsed .wellness-tips {
            display: none;
        }

        /* --- Main Content Area --- */
        .main-content {
            margin-left: 280px;
            min-height: 100vh;
            transition: margin-left 0.3s ease;
            background-color: var(--bg-primary);
        }

        .sidebar.collapsed + .main-content {
            margin-left: 80px;
        }

        .content-header {
            background-color: var(--bg-secondary);
            border-bottom: 1px solid var(--border-light);
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }

        .content-title {
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .theme-toggle-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .theme-toggle {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .theme-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .theme-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border-medium);
            transition: 0.4s;
            border-radius: 34px;
        }

        .theme-slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        .theme-toggle input:checked + .theme-slider {
            background-color: var(--accent-primary);
        }

        .theme-toggle input:checked + .theme-slider:before {
            transform: translateX(26px);
        }

        .content-body {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* --- Advanced Card Components --- */
        .card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-light);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            transition: all 0.2s ease;
        }

        .card:hover {
            box-shadow: var(--shadow-md);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-light);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 0.75rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        /* --- Form Components --- */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-medium);
            border-radius: 0.5rem;
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 0.875rem;
            transition: all 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        /* --- Button Components --- */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .btn-primary {
            background-color: var(--accent-primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: #2563eb;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background-color: var(--accent-secondary);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #059669;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-danger {
            background-color: var(--accent-danger);
            color: white;
        }

        .btn-danger:hover {
            background-color: #dc2626;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-outline {
            background-color: transparent;
            color: var(--text-primary);
            border: 1px solid var(--border-medium);
        }

        .btn-outline:hover {
            background-color: var(--bg-tertiary);
            border-color: var(--accent-primary);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
        }

        .btn-lg {
            padding: 1rem 2rem;
            font-size: 1rem;
        }

        /* --- Chat Interface --- */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 200px);
            background-color: var(--bg-secondary);
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background-color: var(--border-medium);
            border-radius: 3px;
        }

        .message {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            max-width: 80%;
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
        }

        .message.bot .message-avatar {
            background-color: var(--bg-tertiary);
            color: var(--text-secondary);
        }

        .message-content {
            background-color: var(--bg-tertiary);
            padding: 1rem;
            border-radius: 1rem;
            border-bottom-right-radius: 0.25rem;
            box-shadow: var(--shadow-sm);
        }

        .message.user .message-content {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border-bottom-right-radius: 1rem;
            border-bottom-left-radius: 0.25rem;
        }

        .message-text {
            margin: 0;
            line-height: 1.5;
        }

        .message-time {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 0.5rem;
        }

        .message.user .message-time {
            color: rgba(255, 255, 255, 0.7);
        }

        .chat-input-container {
            padding: 1.5rem;
            border-top: 1px solid var(--border-light);
            background-color: var(--bg-secondary);
        }

        .chat-input-form {
            display: flex;
            gap: 0.75rem;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-medium);
            border-radius: 1.5rem;
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            resize: none;
            min-height: 44px;
            max-height: 120px;
            font-family: inherit;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .chat-send-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .chat-send-btn:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-md);
        }

        .chat-send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* --- Loading States --- */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-light);
            border-radius: 50%;
            border-top-color: var(--accent-primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .thinking-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-muted);
            font-style: italic;
        }

        .thinking-dots {
            display: flex;
            gap: 0.25rem;
        }

        .thinking-dot {
            width: 6px;
            height: 6px;
            background-color: var(--text-muted);
            border-radius: 50%;
            animation: pulse 1.4s ease-in-out infinite both;
        }

        .thinking-dot:nth-child(1) { animation-delay: -0.32s; }
        .thinking-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes pulse {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        /* --- Notification System --- */
        .notification {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-light);
            border-radius: 0.75rem;
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow-xl);
            z-index: 2000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            max-width: 400px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 4px solid var(--accent-secondary);
        }

        .notification.error {
            border-left: 4px solid var(--accent-danger);
        }

        .notification.warning {
            border-left: 4px solid var(--accent-warning);
        }

        .notification-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .notification-title {
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0;
        }

        .notification-message {
            color: var(--text-secondary);
            margin: 0;
            line-height: 1.5;
        }

        /* --- Modal System --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background-color: var(--bg-secondary);
            border-radius: 1rem;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.show .modal {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-light);
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 1.5rem;
            padding: 0;
        }

        .modal-body {
            margin-bottom: 1.5rem;
        }

        .modal-footer {
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
        }

        /* --- Data Lists --- */
        .data-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .data-item {
            background-color: var(--bg-tertiary);
            border: 1px solid var(--border-light);
            border-radius: 0.75rem;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s ease;
        }

        .data-item:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }

        .data-item-content {
            flex: 1;
        }

        .data-item-title {
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 0.5rem 0;
        }

        .data-item-subtitle {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin: 0;
        }

        .data-item-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* --- BMI Calculator --- */
        .bmi-calculator {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .bmi-result {
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            font-size: 1.125rem;
            font-weight: 600;
        }

        .bmi-category {
            margin-top: 0.5rem;
            font-size: 0.875rem;
            opacity: 0.9;
        }

        /* --- Mobile Responsiveness --- */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                width: 280px;
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .content-header {
                padding: 1rem;
            }

            .content-body {
                padding: 1rem;
            }

            .chat-container {
                height: calc(100vh - 120px);
            }

            .message {
                max-width: 90%;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .modal {
                margin: 1rem;
                width: calc(100% - 2rem);
            }
        }

        /* --- Animations --- */
        .fade-in {
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-in-right {
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        /* --- Utility Classes --- */
        .hidden { display: none !important; }
        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0; }
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }
        .font-bold { font-weight: 700; }
        .font-semibold { font-weight: 600; }
        .font-medium { font-weight: 500; }
        .text-sm { font-size: 0.875rem; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 1.5rem; }
        .text-3xl { font-size: 1.875rem; }
        .mb-0 { margin-bottom: 0; }
        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mt-0 { margin-top: 0; }
        .mt-1 { margin-top: 0.25rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-6 { margin-top: 1.5rem; }
        .p-0 { padding: 0; }
        .p-1 { padding: 0.25rem; }
        .p-2 { padding: 0.5rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
        .rounded { border-radius: 0.25rem; }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-xl { border-radius: 0.75rem; }
        .rounded-2xl { border-radius: 1rem; }
        .shadow-sm { box-shadow: var(--shadow-sm); }
        .shadow-md { box-shadow: var(--shadow-md); }
        .shadow-lg { box-shadow: var(--shadow-lg); }
        .shadow-xl { box-shadow: var(--shadow-xl); }
        .w-full { width: 100%; }
        .h-full { height: 100%; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 0.5rem; }
        .gap-4 { gap: 1rem; }
        .gap-6 { gap: 1.5rem; }
        .space-y-4 > * + * { margin-top: 1rem; }
        .space-y-6 > * + * { margin-top: 1.5rem; }
    </style>
</head>
<body class="dark-theme">
    <!-- Sidebar -->
    <button class="sidebar-toggle" id="sidebarToggle">
            <i class="fas fa-bars"></i>
        </button>
    
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <div class="sidebar-header .logo img">SS</div>
                <h1>Sehat Sethu</h1>
            </div>
        </div>
        
        <ul class="sidebar-menu">
            <li><a href="#" class="sidebar-item active" data-page="chat">
                <i class="fas fa-comments"></i>
                <span>Chat Assistant</span>
            </a></li>
            <li><a href="#" class="sidebar-item" data-page="profile">
                <i class="fas fa-user-circle"></i>
                <span>Profile</span>
            </a></li>
            <li><a href="#" class="sidebar-item" data-page="medications">
                <i class="fas fa-pills"></i>
                <span>Medications</span>
            </a></li>
            <li><a href="#" class="sidebar-item" data-page="emergency">
                <i class="fas fa-first-aid"></i>
                <span>Emergency Contacts</span>
            </a></li>
            <li><a href="#" class="sidebar-item" data-page="appointments">
                <i class="fas fa-calendar-check"></i>
                <span>Appointments</span>
            </a></li>
            <li><a href="#" class="sidebar-item" data-page="wellness">
                <i class="fas fa-heartbeat"></i>
                <span>Wellness Tips</span>
            </a></li>
        </ul>
        
        <div class="wellness-tips">
            <h4>Daily Wellness Tip</h4>
            <p id="wellnessTipText">Loading your personalized tip...</p>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="content-header">
            <h1 class="content-title" id="pageTitle">Chat Assistant</h1>
            <div class="theme-toggle-container">
                <i class="fas fa-sun"></i>
                <label class="theme-toggle">
                    <input type="checkbox" id="themeToggle">
                    <span class="theme-slider"></span>
                </label>
                <i class="fas fa-moon"></i>
            </div>
        </div>
        
        <div class="content-body" id="contentBody">
            <!-- Dynamic content will be loaded here -->
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- Modal Container -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal" id="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Confirm Action</h3>
                <button class="modal-close" id="modalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="modalBody">
                <p id="modalMessage">Are you sure you want to perform this action?</p>
            </div>
            <div class="modal-footer" id="modalFooter">
                <button class="btn btn-outline" id="modalCancel">Cancel</button>
                <button class="btn btn-danger" id="modalConfirm">Confirm</button>
            </div>
        </div>
    </div>

    <script>
        // --- Global State Management ---
        class AppState {
            constructor() {
                this.data = {
                    profile: {},
                    medications: [],
                    emergency_contacts: [],
                    appointments: []
                };
                this.currentPage = 'chat';
                this.isSidebarCollapsed = false;
                this.isDarkTheme = true;
                this.notificationId = 0;
            }

            // API Communication
            async apiCall(endpoint, method = 'GET', data = null) {
                try {
                    const options = {
                        method,
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    };
                    
                    if (data) {
                        options.body = JSON.stringify(data);
                    }

                    const response = await fetch(`${BASE_URL}${endpoint}`, options);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error('API call failed:', error);
                    this.showNotification('Network error. Please try again.', 'error');
                    throw error;
                }
            }

            // Load user data from backend
            async loadData() {
                try {
                    const data = await this.apiCall('/get_user_data');
                    this.data = data;
                    console.log('Data loaded successfully');
                } catch (error) {
                    console.error('Error loading data:', error);
                }
            }

            // Save profile data
            async saveProfile(profileData) {
                try {
                    await this.apiCall('/save_profile', 'POST', profileData);
                    this.data.profile = profileData;
                    this.showNotification('Profile saved successfully!', 'success');
                } catch (error) {
                    console.error('Error saving profile:', error);
                }
            }

            // Save medication
            async saveMedication(medicationData) {
                try {
                    await this.apiCall('/save_medication', 'POST', medicationData);
                    this.data.medications.push(medicationData);
                    this.showNotification('Medication added successfully!', 'success');
                } catch (error) {
                    console.error('Error saving medication:', error);
                }
            }

            // Update medication
            async updateMedication(index, medicationData) {
                try {
                    await this.apiCall(`/update_medication/${index}`, 'PUT', medicationData);
                    this.data.medications[index] = medicationData;
                    this.showNotification('Medication updated successfully!', 'success');
                } catch (error) {
                    console.error('Error updating medication:', error);
                }
            }

            // Delete medication
            async deleteMedication(index) {
                try {
                    await this.apiCall(`/delete_medication/${index}`, 'DELETE');
                    this.data.medications.splice(index, 1);
                    this.showNotification('Medication deleted successfully!', 'success');
                } catch (error) {
                    console.error('Error deleting medication:', error);
                }
            }

            // Save emergency contact
            async saveEmergencyContact(contactData) {
                try {
                    await this.apiCall('/save_emergency_contact', 'POST', contactData);
                    this.data.emergency_contacts.push(contactData);
                    this.showNotification('Emergency contact added successfully!', 'success');
                } catch (error) {
                    console.error('Error saving emergency contact:', error);
                }
            }

            // Update emergency contact
            async updateEmergencyContact(index, contactData) {
                try {
                    await this.apiCall(`/update_emergency_contact/${index}`, 'PUT', contactData);
                    this.data.emergency_contacts[index] = contactData;
                    this.showNotification('Emergency contact updated successfully!', 'success');
                } catch (error) {
                    console.error('Error updating emergency contact:', error);
                }
            }

            // Delete emergency contact
            async deleteEmergencyContact(index) {
                try {
                    await this.apiCall(`/delete_emergency_contact/${index}`, 'DELETE');
                    this.data.emergency_contacts.splice(index, 1);
                    this.showNotification('Emergency contact deleted successfully!', 'success');
                } catch (error) {
                    console.error('Error deleting emergency contact:', error);
                }
            }

            // Save appointment
            async saveAppointment(appointmentData) {
                try {
                    await this.apiCall('/save_appointment', 'POST', appointmentData);
                    this.data.appointments.push(appointmentData);
                    this.showNotification('Appointment added successfully!', 'success');
                } catch (error) {
                    console.error('Error saving appointment:', error);
                }
            }

            // Update appointment
            async updateAppointment(index, appointmentData) {
                try {
                    await this.apiCall(`/update_appointment/${index}`, 'PUT', appointmentData);
                    this.data.appointments[index] = appointmentData;
                    this.showNotification('Appointment updated successfully!', 'success');
                } catch (error) {
                    console.error('Error updating appointment:', error);
                }
            }

            // Delete appointment
            async deleteAppointment(index) {
                try {
                    await this.apiCall(`/delete_appointment/${index}`, 'DELETE');
                    this.data.appointments.splice(index, 1);
                    this.showNotification('Appointment deleted successfully!', 'success');
                } catch (error) {
                    console.error('Error deleting appointment:', error);
                }
            }

            // Get weather tip
            async getWeatherTip() {
                try {
                    const response = await this.apiCall('/get_weather_tip');
                    return response.tip;
                } catch (error) {
                    console.error('Error getting weather tip:', error);
                    return "Remember to stay hydrated and maintain a balanced diet for optimal health!";
                }
            }

            // Theme management
            setTheme(isDark) {
                this.isDarkTheme = isDark;
                document.body.classList.toggle('dark-theme', isDark);
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
            }

            // Notification system
            showNotification(message, type = 'success', duration = 5000) {
                const container = document.getElementById('notificationContainer');
                const notification = document.createElement('div');
                const id = ++this.notificationId;
                
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <div class="notification-header">
                        <h4 class="notification-title">${type.charAt(0).toUpperCase() + type.slice(1)}</h4>
                        <button class="notification-close" onclick="this.parentElement.parentElement.remove()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <p class="notification-message">${message}</p>
                `;
                
                container.appendChild(notification);
                
                // Trigger animation
                setTimeout(() => notification.classList.add('show'), 100);
                
                // Auto remove
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.classList.remove('show');
                        setTimeout(() => notification.remove(), 300);
                    }
                }, duration);
            }

            // Modal system
            showModal(title, message, onConfirm = null, confirmText = 'Confirm', cancelText = 'Cancel') {
                const modal = document.getElementById('modalOverlay');
                const modalTitle = document.getElementById('modalTitle');
                const modalMessage = document.getElementById('modalMessage');
                const modalConfirm = document.getElementById('modalConfirm');
                const modalCancel = document.getElementById('modalCancel');
                
                modalTitle.textContent = title;
                modalMessage.textContent = message;
                modalConfirm.textContent = confirmText;
                modalCancel.textContent = cancelText;
                
                modal.classList.add('show');
                
                // Remove existing listeners
                const newConfirm = modalConfirm.cloneNode(true);
                const newCancel = modalCancel.cloneNode(true);
                modalConfirm.parentNode.replaceChild(newConfirm, modalConfirm);
                modalCancel.parentNode.replaceChild(newCancel, modalCancel);
                
                // Add new listeners
                newConfirm.addEventListener('click', () => {
                    modal.classList.remove('show');
                    if (onConfirm) onConfirm(true);
                });
                
                newCancel.addEventListener('click', () => {
                    modal.classList.remove('show');
                    if (onConfirm) onConfirm(false);
                });
            }
        }

        // Initialize app state
        const app = new AppState();

        // --- Page Management ---
        class PageManager {
            constructor() {
                this.pages = {
                    chat: new ChatPage(),
                    profile: new ProfilePage(),
                    medications: new MedicationsPage(),
                    emergency: new EmergencyPage(),
                    appointments: new AppointmentsPage(),
                    wellness: new WellnessPage()
                };
            }

            async loadPage(pageId) {
                // Update active sidebar item
                document.querySelectorAll('.sidebar-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelector(`[data-page="${pageId}"]`).classList.add('active');

                // Update page title
                const titles = {
                    chat: 'Chat Assistant',
                    profile: 'Profile Management',
                    medications: 'Medication Tracker',
                    emergency: 'Emergency Contacts',
                    appointments: 'Appointments',
                    wellness: 'Wellness Tips'
                };
                document.getElementById('pageTitle').textContent = titles[pageId] || 'Sehat Sethu';

                // Load page content
                const contentBody = document.getElementById('contentBody');
                contentBody.innerHTML = this.pages[pageId].render();
                
                // Initialize page
                await this.pages[pageId].init();
                
                app.currentPage = pageId;
            }
        }

// Base URL for API calls
const BASE_URL = "https://sehat-sethu-2.onrender.com"; // replace with your real Render URL

        // --- Chat Page ---
        class ChatPage {
            render() {
                return `
                    <div class="chat-container" id="chatContainer">

<!-- Chat History Page (hidden by default) -->
<div id="chatHistoryPage" class="hidden">
    <div class="history-container p-4 max-w-3xl mx-auto">
        <!-- Header with title and Clear History button -->
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold">Chat History</h2>
            <button id="clearHistoryBtn"
                    class="px-4 py-2 bg-red-500 hover:bg-red-600 dark:bg-red-600 dark:hover:bg-red-700 text-white text-sm rounded shadow transition duration-200">
                🗑 Clear History
            </button>
        </div>

        <!-- Chat messages container -->
        <div id="chatHistory" class="space-y-2 overflow-y-auto max-h-[70vh] border p-2 rounded bg-gray-50 dark:bg-gray-800">
            <!-- Messages will be inserted here dynamically -->
        </div>

        <button id="backToChatBtn"
                class="mt-4 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded shadow">
            ← Back to Chat
        </button>
    </div>
</div>

<!-- Main Chat Header -->
<div class="flex justify-between items-center mb-2 px-2 gap-2">
  <h2 class="text-lg font-semibold">Chat</h2>
  <div class="flex gap-2">
    <button id="historyBtn" 
            class="flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white text-sm font-medium rounded-lg shadow transition">
        📜 Chat History
    </button>
    <button id="clearChatBtn" 
            class="flex items-center gap-2 px-4 py-2 bg-red-500 hover:bg-red-600 text-white text-sm font-medium rounded-lg shadow transition"
            title="Start a new chat">
        🆕 New Chat
    </button>
  </div>
</div>

                        <div class="chat-messages" id="chatMessages"></div>

                        <div class="chat-input-container">
                            <form class="chat-input-form" id="chatForm">
                                <textarea class="chat-input" id="chatInput" placeholder="Type your message here..." rows="1"></textarea>
                                <button type="submit" class="chat-send-btn" id="chatSendBtn">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                `;
            }

addMessage(text, sender, timestamp = null) {
    const chatMessages = document.getElementById('chatMessages');
    const messageDiv = document.createElement('div');
    const id = Date.now(); // unique ID

    messageDiv.className = `message ${sender}`;
    messageDiv.dataset.id = id;

    // ✅ If bot → render Markdown
    const parsedText = sender === 'bot' ? marked.parse(text) : text;

    // ✅ Use backend timestamp if provided, otherwise fallback to now
    const timeString = timestamp
        ? new Date(timestamp).toLocaleString()
        : new Date().toLocaleTimeString();

    messageDiv.innerHTML = `
        <div class="message-avatar">
            <i class="fas ${sender === 'user' ? 'fa-user' : 'fa-robot'}"></i>
        </div>
        <div class="message-content">
            <div class="message-text">${parsedText}</div>
            <div class="message-time">${timeString}</div>
            ${sender === 'user' ? `<button class="edit-btn">✎ Edit</button>` : ''}
        </div>
    `;

    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

async init() {
    const chatForm = document.getElementById('chatForm');
    const chatInput = document.getElementById('chatInput');
    const chatMessages = document.getElementById('chatMessages');

    // --- Load chat history on page load ---
    try {
        const data = await app.apiCall("/get_chat_history", "GET");
        if (data.status === "success") {
            data.history.forEach(item => {
                if(item.user) this.addMessage(item.user, "user");
                if(item.bot) this.addMessage(item.bot, "bot");
            });
        }
    } catch {
        app.showNotification("Failed to load history", "error");
    }

    // --- Auto-resize textarea ---
    chatInput.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = Math.min(this.scrollHeight, 120) + 'px';
    });

    // --- Send message ---
    chatForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const message = chatInput.value.trim();
        if (!message) return;

        this.addMessage(message, 'user');
        chatInput.value = '';
        chatInput.style.height = 'auto';

        const thinkingDiv = this.addThinkingIndicator();
        try {
            const response = await app.apiCall(`/ask`, 'POST', { message });
            thinkingDiv.remove();
            this.addMessage(response.reply, 'bot');
        } catch {
            thinkingDiv.remove();
            this.addMessage('Sorry, an error occurred. Please try again.', 'bot');
        }
    });

    // --- Edit user messages ---
    chatMessages.addEventListener('click', (e) => {
        if (e.target.classList.contains('edit-btn')) {
            const messageDiv = e.target.closest('.message');
            const messageText = messageDiv.querySelector('.message-text');
            const oldText = messageText.innerText;
            const editId = messageDiv.dataset.id;

            const newText = prompt('Edit your message:', oldText);
            if (!newText) return;

            messageText.innerText = newText;

            app.apiCall(`/ask`, "POST", { message: newText, edit_id: editId })
                .then(data => {
                    // Remove all messages after this one
                    let next = messageDiv.nextElementSibling;
                    while (next) {
                        const toRemove = next;
                        next = next.nextElementSibling;
                        toRemove.remove();
                    }
                    // Add fresh bot reply
                    this.addMessage(data.reply, 'bot');
                })
                .catch(() => {
                    app.showNotification("Edit failed. Please try again.", "error");
                });
        }
    });

    // --- Clear / New Chat button ---
    document.getElementById("clearChatBtn").addEventListener("click", async () => {
        if (!confirm("Start a new chat? All previous messages will be cleared.")) return;

        try {
            // Clear backend chat log (resets with greeting)
            const data = await app.apiCall("/clear_chat", "POST");
            if (data.status === "success") {
                chatMessages.innerHTML = ""; // clear frontend
                app.showNotification("New chat started!", "success");

                // Reload initial greeting from backend
                const history = await app.apiCall("/get_chat_history", "GET");
                if (history.status === "success") {
                    history.history.forEach(item => {
                        if(item.bot) this.addMessage(item.bot, "bot");
                    });
                }
            } else {
                app.showNotification("Failed to start new chat.", "error");
            }
        } catch {
            app.showNotification("Failed to start new chat.", "error");
        }
    });
    // --- Toggle to Chat History page ---
document.getElementById("historyBtn").addEventListener("click", () => {
    document.getElementById("chatContainer").classList.add("hidden"); // hide main chat
    document.getElementById("chatHistoryPage").classList.remove("hidden"); // show history
    loadChatHistory(); // load messages dynamically
});

    // --- Back to Chat page ---
    document.getElementById("backToChatBtn").addEventListener("click", () => {
        document.getElementById("chatHistoryPage").classList.add("hidden"); // hide history
        document.getElementById("chatContainer").classList.remove("hidden"); // show main chat
    });
    // --- Load chat history dynamically ---
async function loadChatHistory() {
    const chatHistoryDiv = document.getElementById("chatHistory");
    chatHistoryDiv.innerHTML = ""; // clear old messages

    try {
        const response = await app.apiCall("/get_chat_history", "GET");
        if (response.status === "success") {
            response.history.forEach(item => {
                if (item.user) {
                    chatHistoryDiv.innerHTML += `
                        <div class="p-2 rounded border bg-blue-100 dark:bg-blue-900 mb-2">
                            <div class="font-semibold text-blue-800 dark:text-blue-200">User:</div>
                            <div>${item.user}</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">${item.time || ''}</div>
                        </div>
                    `;
                }
                if (item.bot) {
                    chatHistoryDiv.innerHTML += `
                        <div class="p-2 rounded border bg-gray-100 dark:bg-gray-700 mb-2">
                            <div class="font-semibold text-gray-800 dark:text-gray-200">Bot:</div>
                            <div>${item.bot}</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">${item.time || ''}</div>
                        </div>
                    `;
                }
            });
        }
    } catch {
        chatHistoryDiv.innerHTML = `<p class="text-red-500">Failed to load chat history.</p>`;
    }
}

// --- Event listeners for History page buttons ---
document.getElementById("historyBtn").addEventListener("click", () => {
    document.getElementById("chatContainer").classList.add("hidden");
    document.getElementById("chatHistoryPage").classList.remove("hidden");
    loadChatHistory();
});

document.getElementById("backToChatBtn").addEventListener("click", () => {
    document.getElementById("chatHistoryPage").classList.add("hidden");
    document.getElementById("chatContainer").classList.remove("hidden");
});

document.getElementById("clearHistoryBtn").addEventListener("click", async () => {
    if (!confirm("Are you sure you want to clear all chat history?")) return;

    try {
        const response = await app.apiCall("/clear_chat_history", "POST");
        if (response.status === "success") {
            document.getElementById("chatHistory").innerHTML = `<p class="text-gray-500 dark:text-gray-400">No chat history.</p>`;
        } else {
            app.showNotification("Failed to clear chat history.", "error");
        }
    } catch {
        app.showNotification("Failed to clear chat history.", "error");
    }
});

}

            addThinkingIndicator() {
                const chatMessages = document.getElementById('chatMessages');
                const thinkingDiv = document.createElement('div');
                thinkingDiv.className = 'message bot thinking-indicator';
                thinkingDiv.innerHTML = `
                    <div class="message-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">
                        <div class="thinking-indicator">
                            <span>HealthBot is thinking</span>
                            <div class="thinking-dots">
                                <div class="thinking-dot"></div>
                                <div class="thinking-dot"></div>
                                <div class="thinking-dot"></div>
                            </div>
                        </div>
                    </div>
                `;
                chatMessages.appendChild(thinkingDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                return thinkingDiv;
            }
        }

        // --- Profile Page ---
        class ProfilePage {
            render() {
                return `
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Profile Management</h2>
                            <div class="card-icon">
                                <i class="fas fa-user-circle"></i>
                            </div>
                        </div>
                        
                        <!-- BMI Calculator -->
                        <div class="bmi-calculator">
                            <h3>BMI Calculator</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Height (cm)</label>
                                    <input type="number" class="form-input" id="bmiHeight" placeholder="e.g., 175">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Weight (kg)</label>
                                    <input type="number" class="form-input" id="bmiWeight" placeholder="e.g., 70">
                                </div>
                            </div>
                            <button class="btn btn-primary" id="calculateBmi">Calculate BMI</button>
                            <div id="bmiResult" class="bmi-result hidden"></div>
                        </div>

                        <!-- Profile Form -->
                        <form id="profileForm" class="space-y-6">
                            <h3 class="text-xl font-semibold text-white mb-4">Personal Information</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Name</label>
                                    <input type="text" class="form-input" id="profileName" placeholder="Your Full Name">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Date of Birth</label>
                                    <input type="date" class="form-input" id="profileDob">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Gender</label>
                                    <input type="text" class="form-input" id="profileGender" placeholder="Your Gender">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Blood Group</label>
                                    <input type="text" class="form-input" id="profileBloodGroup" placeholder="e.g., A+">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Known Conditions</label>
                                <input type="text" class="form-input" id="profileConditions" placeholder="e.g., Diabetes, Hypertension">
                            </div>
                            
                            <!-- Custom Fields -->
                            <div class="form-group">
                                <h3 class="text-lg font-semibold text-white mb-2">Custom Fields</h3>
                                <div id="customFields" class="space-y-4"></div>
                                <button type="button" class="btn btn-outline" id="addCustomField">
                                    <i class="fas fa-plus"></i> Add Custom Field
                                </button>
                            </div>
                            
                            <div class="flex justify-end">
                                <button type="submit" class="btn btn-primary">Save Profile</button>
                            </div>
                        </form>
                    </div>
                `;
            }

            async init() {
                // Load existing profile data
                await app.loadData();
                this.populateForm();

                // BMI Calculator
                document.getElementById('calculateBmi').addEventListener('click', () => {
                    this.calculateBMI();
                });

                // Profile form
                document.getElementById('profileForm').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    await this.saveProfile();
                });

                // Add custom field
                document.getElementById('addCustomField').addEventListener('click', () => {
                    this.addCustomField();
                });
            }

            populateForm() {
                const profile = app.data.profile || {};
                document.getElementById('profileName').value = profile.name || '';
                document.getElementById('profileDob').value = profile.dob || '';
                document.getElementById('profileGender').value = profile.gender || '';
                document.getElementById('profileBloodGroup').value = profile.blood_group || '';
                document.getElementById('profileConditions').value = profile.conditions || '';

                // Load custom fields
                const customFieldsContainer = document.getElementById('customFields');
                customFieldsContainer.innerHTML = '';
                
                for (const [key, value] of Object.entries(profile)) {
                    if (!['name', 'dob', 'gender', 'blood_group', 'conditions'].includes(key)) {
                        this.addCustomField(key, value);
                    }
                }
            }

            calculateBMI() {
                const height = parseFloat(document.getElementById('bmiHeight').value);
                const weight = parseFloat(document.getElementById('bmiWeight').value);
                const resultDiv = document.getElementById('bmiResult');

                if (height > 0 && weight > 0) {
                    const heightM = height / 100;
                    const bmi = weight / (heightM * heightM);
                    let category = '';
                    let colorClass = '';

                    if (bmi < 18.5) {
                        category = 'Underweight';
                        colorClass = 'bg-yellow-500';
                    } else if (bmi >= 18.5 && bmi < 24.9) {
                        category = 'Normal weight';
                        colorClass = 'bg-green-500';
                    } else if (bmi >= 25 && bmi < 29.9) {
                        category = 'Overweight';
                        colorClass = 'bg-yellow-500';
                    } else {
                        category = 'Obesity';
                        colorClass = 'bg-red-500';
                    }

                    resultDiv.innerHTML = `
                        <div class="text-center">
                            <div class="text-2xl font-bold">BMI: ${bmi.toFixed(2)}</div>
                            <div class="bmi-category ${colorClass} px-4 py-2 rounded-lg mt-2">${category}</div>
                        </div>
                    `;
                    resultDiv.classList.remove('hidden');
                } else {
                    app.showNotification('Please enter valid height and weight.', 'error');
                }
            }

            addCustomField(key = '', value = '') {
                const container = document.getElementById('customFields');
                const fieldDiv = document.createElement('div');
                fieldDiv.className = 'form-grid';
                fieldDiv.innerHTML = `
                    <div class="form-group">
                        <label class="form-label">Field Name</label>
                        <input type="text" class="form-input" placeholder="e.g., Allergies" value="${key}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Field Value</label>
                        <input type="text" class="form-input" placeholder="e.g., Penicillin" value="${value}">
                    </div>
                    <div class="form-group flex items-end">
                        <button type="button" class="btn btn-danger btn-sm" onclick="this.parentElement.parentElement.remove()">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                container.appendChild(fieldDiv);
            }

            async saveProfile() {
                const profileData = {
                    name: document.getElementById('profileName').value,
                    dob: document.getElementById('profileDob').value,
                    gender: document.getElementById('profileGender').value,
                    blood_group: document.getElementById('profileBloodGroup').value,
                    conditions: document.getElementById('profileConditions').value
                };

                // Add custom fields
                const customFields = document.querySelectorAll('#customFields .form-grid');
                customFields.forEach(field => {
                    const keyInput = field.querySelector('input:nth-of-type(1)');
                    const valueInput = field.querySelector('input:nth-of-type(2)');
                    if (keyInput.value && valueInput.value) {
                        profileData[keyInput.value] = valueInput.value;
                    }
                });

                await app.saveProfile(profileData);
            }
        }

// --- Medications Page ---
class MedicationsPage {
    render() {
        return `
            <div class="space-y-6">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Add Medication</h2>
                        <div class="card-icon">
                            <i class="fas fa-pills"></i>
                        </div>
                    </div>
                    <form id="medicationForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Medication Name</label>
                                <input type="text" class="form-input" id="medName" placeholder="e.g., Metformin">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Dosage</label>
                                <input type="text" class="form-input" id="medDosage" placeholder="e.g., 500mg">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Schedule</label>
                                <input type="text" class="form-input" id="medSchedule" placeholder="e.g., Daily, 8am">
                            </div>
                        </div>
                        <div class="flex justify-end">
                            <button type="submit" class="btn btn-primary">Add Medication</button>
                        </div>
                    </form>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Your Medications</h2>
                        <div class="card-icon">
                            <i class="fas fa-list"></i>
                        </div>
                    </div>
                    <div id="medicationsList" class="data-list">
                        <!-- Medications will be loaded here -->
                    </div>
                </div>
            </div>
        `;
    }

    async init() {
        await app.loadData();
        this.renderMedications();

        // ✅ Prevent double form binding
        const form = document.getElementById('medicationForm');
        if (!form.dataset.bound) {
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                await this.saveMedication();
            });
            form.dataset.bound = "true";
        }

        // ✅ Event delegation for edit/delete
        const container = document.getElementById('medicationsList');
        if (!container.dataset.bound) {
            container.addEventListener('click', (e) => {
                const item = e.target.closest('.data-item');
                if (!item) return;
                const index = parseInt(item.dataset.index);

                if (e.target.closest('.edit-btn')) {
                    this.editMedication(index);
                }
                if (e.target.closest('.delete-btn')) {
                    this.deleteMedication(index);
                }
            });
            container.dataset.bound = "true";
        }
    }

    renderMedications() {
        const container = document.getElementById('medicationsList');
        container.innerHTML = '';

        if (app.data.medications.length === 0) {
            container.innerHTML = '<p class="text-center text-gray-500">No medications added yet.</p>';
            return;
        }

        app.data.medications.forEach((med, index) => {
            const medDiv = document.createElement('div');
            medDiv.className = 'data-item';
            medDiv.dataset.index = index; // ✅ needed for delegation

            medDiv.innerHTML = `
                <div class="data-item-content">
                    <div class="data-item-title">${med.name}</div>
                    <div class="data-item-subtitle">Dosage: ${med.dosage} | Schedule: ${med.schedule}</div>
                </div>
                <div class="data-item-actions">
                    <button class="btn btn-outline btn-sm edit-btn">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="btn btn-danger btn-sm delete-btn">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            `;
            container.appendChild(medDiv);
        });
    }

    async saveMedication() {
        const medicationData = {
            name: document.getElementById('medName').value,
            dosage: document.getElementById('medDosage').value,
            schedule: document.getElementById('medSchedule').value
        };

        if (!medicationData.name || !medicationData.dosage || !medicationData.schedule) {
            app.showNotification('Please fill in all fields.', 'error');
            return;
        }

        await app.saveMedication(medicationData);
        document.getElementById('medicationForm').reset();
        this.renderMedications();
    }

    async editMedication(index) {
        const medication = app.data.medications[index];
        document.getElementById('medName').value = medication.name;
        document.getElementById('medDosage').value = medication.dosage;
        document.getElementById('medSchedule').value = medication.schedule;

        // Change form to update mode
        const form = document.getElementById('medicationForm');
        const submitBtn = form.querySelector('button[type="submit"]');
        submitBtn.textContent = 'Update Medication';
        submitBtn.onclick = async (e) => {
            e.preventDefault();
            const updatedData = {
                name: document.getElementById('medName').value,
                dosage: document.getElementById('medDosage').value,
                schedule: document.getElementById('medSchedule').value
            };
            await app.updateMedication(index, updatedData);
            form.reset();
            submitBtn.textContent = 'Add Medication';
            this.renderMedications();
        };
    }

    async deleteMedication(index) {
        app.showModal(
            'Delete Medication',
            'Are you sure you want to delete this medication?',
            async (confirmed) => {
                if (confirmed) {
                    await app.deleteMedication(index);
                    this.renderMedications();
                }
            }
        );
    }
}

        // --- Emergency Page ---
class EmergencyPage {
    render() {
        return `
            <div class="space-y-6">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Add Emergency Contact</h2>
                        <div class="card-icon">
                            <i class="fas fa-first-aid"></i>
                        </div>
                    </div>
                    <form id="emergencyForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Contact Name</label>
                                <input type="text" class="form-input" id="contactName" placeholder="e.g., Dr. Smith">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Phone Number</label>
                                <input type="tel" class="form-input" id="contactPhone" placeholder="e.g., +1234567890">
                            </div>
                        </div>
                        
                        <!-- Custom Fields -->
                        <div class="form-group">
                            <h3 class="text-lg font-semibold text-white mb-2">Additional Information</h3>
                            <div id="emergencyCustomFields" class="space-y-4"></div>
                            <button type="button" class="btn btn-outline" id="addEmergencyField">
                                <i class="fas fa-plus"></i> Add Field
                            </button>
                        </div>
                        
                        <div class="flex justify-end">
                            <button type="submit" class="btn btn-primary">Add Contact</button>
                        </div>
                    </form>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Emergency Contacts</h2>
                        <div class="card-icon">
                            <i class="fas fa-list"></i>
                        </div>
                    </div>
                    <div id="emergencyList" class="data-list">
                        <!-- Contacts will be loaded here -->
                    </div>
                </div>
            </div>
        `;
    }

    async init() {
        await app.loadData();
        this.renderContacts();

        // ✅ Prevent double binding
        const form = document.getElementById('emergencyForm');
        if (!form.dataset.bound) {
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                await this.saveContact();
            });
            form.dataset.bound = "true";
        }

        document.getElementById('addEmergencyField').addEventListener('click', () => {
            this.addCustomField();
        });

        // ✅ Event delegation for edit/delete
        const container = document.getElementById('emergencyList');
        if (!container.dataset.bound) {
            container.addEventListener('click', (e) => {
                const item = e.target.closest('.data-item');
                if (!item) return;
                const index = parseInt(item.dataset.index);

                if (e.target.closest('.edit-btn')) {
                    this.editContact(index);
                }
                if (e.target.closest('.delete-btn')) {
                    this.deleteContact(index);
                }
            });
            container.dataset.bound = "true";
        }
    }

    renderContacts() {
        const container = document.getElementById('emergencyList');
        container.innerHTML = '';

        if (app.data.emergency_contacts.length === 0) {
            container.innerHTML = '<p class="text-center text-gray-500">No emergency contacts added yet.</p>';
            return;
        }

        app.data.emergency_contacts.forEach((contact, index) => {
            const contactDiv = document.createElement('div');
            contactDiv.className = 'data-item';
            contactDiv.dataset.index = index; // ✅ needed for delegation
            
            let customFieldsHtml = '';
            for (const [key, value] of Object.entries(contact)) {
                if (key !== 'name' && key !== 'phone') {
                    customFieldsHtml += `<div class="text-sm text-gray-400">${key}: ${value}</div>`;
                }
            }

            contactDiv.innerHTML = `
                <div class="data-item-content">
                    <div class="data-item-title">${contact.name}</div>
                    <div class="data-item-subtitle">Phone: ${contact.phone}</div>
                    ${customFieldsHtml}
                </div>
                <div class="data-item-actions">
                    <button class="btn btn-outline btn-sm edit-btn">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="btn btn-danger btn-sm delete-btn">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            `;
            container.appendChild(contactDiv);
        });
    }

    addCustomField(key = '', value = '') {
        const container = document.getElementById('emergencyCustomFields');
        const fieldDiv = document.createElement('div');
        fieldDiv.className = 'form-grid';
        fieldDiv.innerHTML = `
            <div class="form-group">
                <label class="form-label">Field Name</label>
                <input type="text" class="form-input" placeholder="e.g., Relationship" value="${key}">
            </div>
            <div class="form-group">
                <label class="form-label">Field Value</label>
                <input type="text" class="form-input" placeholder="e.g., Doctor" value="${value}">
            </div>
            <div class="form-group flex items-end">
                <button type="button" class="btn btn-danger btn-sm" onclick="this.parentElement.parentElement.remove()">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        `;
        container.appendChild(fieldDiv);
    }

    async saveContact() {
        const contactData = {
            name: document.getElementById('contactName').value,
            phone: document.getElementById('contactPhone').value
        };

        if (!contactData.name || !contactData.phone) {
            app.showNotification('Please fill in name and phone number.', 'error');
            return;
        }

        // Add custom fields
        const customFields = document.querySelectorAll('#emergencyCustomFields .form-grid');
        customFields.forEach(field => {
            const keyInput = field.querySelector('input:nth-of-type(1)');
            const valueInput = field.querySelector('input:nth-of-type(2)');
            if (keyInput.value && valueInput.value) {
                contactData[keyInput.value] = valueInput.value;
            }
        });

        await app.saveEmergencyContact(contactData);
        document.getElementById('emergencyForm').reset();
        document.getElementById('emergencyCustomFields').innerHTML = '';
        this.renderContacts();
    }

    async editContact(index) {
        const contact = app.data.emergency_contacts[index];
        document.getElementById('contactName').value = contact.name;
        document.getElementById('contactPhone').value = contact.phone;

        // Load custom fields
        const customFieldsContainer = document.getElementById('emergencyCustomFields');
        customFieldsContainer.innerHTML = '';
        
        for (const [key, value] of Object.entries(contact)) {
            if (key !== 'name' && key !== 'phone') {
                this.addCustomField(key, value);
            }
        }

        // Change form to update mode
        const form = document.getElementById('emergencyForm');
        const submitBtn = form.querySelector('button[type="submit"]');
        submitBtn.textContent = 'Update Contact';
        submitBtn.onclick = async (e) => {
            e.preventDefault();
            const updatedData = {
                name: document.getElementById('contactName').value,
                phone: document.getElementById('contactPhone').value
            };

            // Add custom fields
            const customFields = document.querySelectorAll('#emergencyCustomFields .form-grid');
            customFields.forEach(field => {
                const keyInput = field.querySelector('input:nth-of-type(1)');
                const valueInput = field.querySelector('input:nth-of-type(2)');
                if (keyInput.value && valueInput.value) {
                    updatedData[keyInput.value] = valueInput.value;
                }
            });

            await app.updateEmergencyContact(index, updatedData);
            form.reset();
            customFieldsContainer.innerHTML = '';
            submitBtn.textContent = 'Add Contact';
            this.renderContacts();
        };
    }

    async deleteContact(index) {
        app.showModal(
            'Delete Contact',
            'Are you sure you want to delete this emergency contact?',
            async (confirmed) => {
                if (confirmed) {
                    await app.deleteEmergencyContact(index);
                    this.renderContacts();
                }
            }
        );
    }
}

// --- Appointments Page ---
class AppointmentsPage {
    render() {
        return `
            <div class="space-y-6">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Add Appointment</h2>
                        <div class="card-icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                    </div>
                    <form id="appointmentForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Appointment Title</label>
                                <input type="text" class="form-input" id="apptTitle" placeholder="e.g., Annual Checkup">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Date</label>
                                <input type="date" class="form-input" id="apptDate">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Time</label>
                                <input type="time" class="form-input" id="apptTime">
                            </div>
                        </div>
                        <div class="flex justify-end">
                            <button type="submit" class="btn btn-primary">Add Appointment</button>
                        </div>
                    </form>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Your Appointments</h2>
                        <div class="card-icon">
                            <i class="fas fa-list"></i>
                        </div>
                    </div>
                    <div id="appointmentsList" class="data-list">
                        <!-- Appointments will be loaded here -->
                    </div>
                </div>
            </div>
        `;
    }

    async init() {
        await app.loadData();
        this.renderAppointments();

        // ✅ Prevent duplicate binding
        const form = document.getElementById('appointmentForm');
        if (!form.dataset.bound) {
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                await this.saveAppointment();
            });
            form.dataset.bound = "true";
        }

        // ✅ Event delegation for edit/delete
        const container = document.getElementById('appointmentsList');
        if (!container.dataset.bound) {
            container.addEventListener('click', (e) => {
                const item = e.target.closest('.data-item');
                if (!item) return;
                const index = parseInt(item.dataset.index);

                if (e.target.closest('.edit-btn')) {
                    this.editAppointment(index);
                }
                if (e.target.closest('.delete-btn')) {
                    this.deleteAppointment(index);
                }
            });
            container.dataset.bound = "true";
        }
    }

    renderAppointments() {
        const container = document.getElementById('appointmentsList');
        container.innerHTML = '';

        if (app.data.appointments.length === 0) {
            container.innerHTML = '<p class="text-center text-gray-500">No appointments scheduled yet.</p>';
            return;
        }

        app.data.appointments.forEach((appt, index) => {
            const apptDiv = document.createElement('div');
            apptDiv.className = 'data-item';
            apptDiv.dataset.index = index; // ✅ needed for delegation

            apptDiv.innerHTML = `
                <div class="data-item-content">
                    <div class="data-item-title">${appt.title}</div>
                    <div class="data-item-subtitle">Date: ${appt.date} | Time: ${appt.time}</div>
                </div>
                <div class="data-item-actions">
                    <button class="btn btn-outline btn-sm edit-btn">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="btn btn-danger btn-sm delete-btn">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            `;
            container.appendChild(apptDiv);
        });
    }

    async saveAppointment() {
        const appointmentData = {
            title: document.getElementById('apptTitle').value,
            date: document.getElementById('apptDate').value,
            time: document.getElementById('apptTime').value
        };

        if (!appointmentData.title || !appointmentData.date || !appointmentData.time) {
            app.showNotification('Please fill in all fields.', 'error');
            return;
        }

        await app.saveAppointment(appointmentData);
        document.getElementById('appointmentForm').reset();
        this.renderAppointments();
    }

    async editAppointment(index) {
        const appointment = app.data.appointments[index];
        document.getElementById('apptTitle').value = appointment.title;
        document.getElementById('apptDate').value = appointment.date;
        document.getElementById('apptTime').value = appointment.time;

        // Change form to update mode
        const form = document.getElementById('appointmentForm');
        const submitBtn = form.querySelector('button[type="submit"]');
        submitBtn.textContent = 'Update Appointment';
        submitBtn.onclick = async (e) => {
            e.preventDefault();
            const updatedData = {
                title: document.getElementById('apptTitle').value,
                date: document.getElementById('apptDate').value,
                time: document.getElementById('apptTime').value
            };
            await app.updateAppointment(index, updatedData);
            form.reset();
            submitBtn.textContent = 'Add Appointment';
            this.renderAppointments();
        };
    }

    async deleteAppointment(index) {
        app.showModal(
            'Delete Appointment',
            'Are you sure you want to delete this appointment?',
            async (confirmed) => {
                if (confirmed) {
                    await app.deleteAppointment(index);
                    this.renderAppointments();
                }
            }
        );
    }
}
// --- Wellness Page ---
class WellnessPage {
    render() {
        return `
            <div class="card text-center">
                <div class="card-header">
                    <h2 class="card-title">Daily Wellness Tips</h2>
                    <div class="card-icon">
                        <i class="fas fa-heartbeat"></i>
                    </div>
                </div>
                <div class="p-8">
                    <div id="wellnessTipDisplay" class="text-lg font-bold font-sans mb-6 text-blue-900 dark:text-blue-300">
                        Loading your personalized tip...
                    </div>
                    <button class="btn btn-primary" id="refreshTip">
                        <i class="fas fa-refresh"></i> Get New Tip
                    </button>
                </div>
            </div>
        `;
    }

    async init() {
        await this.loadWellnessTip();

        const refreshBtn = document.getElementById('refreshTip');
        if (!refreshBtn.dataset.bound) {
            refreshBtn.addEventListener('click', async () => {
                await this.loadWellnessTip();
            });
            refreshBtn.dataset.bound = "true"; // ✅ Prevent duplicate binding
        }
    }

    async loadWellnessTip() {
        const categories = {
            "Workout": [
                "Do 3 sets of 15 squats 🏋️‍♂️<br>1. Stand straight.<br>2. Lower hips as if sitting.<br>3. Keep knees behind toes.<br>4. Rise back up.",
                "Push-ups (3 sets of 10) 💪<br>1. Keep body straight.<br>2. Lower chest to the ground.<br>3. Push back up.",
                "Plank Hold (3 sets, 30 sec each) 🤸<br>1. Keep back straight.<br>2. Engage core.<br>3. Don’t drop hips.",
                "Jumping Jacks (3 sets of 20) 🏃‍♂️<br>1. Jump with arms overhead.<br>2. Return to standing.<br>3. Repeat quickly."
            ],
            "Diseases": [
                "For Diabetes: 🍬<br>1. Walk 30 mins daily.<br>2. Eat high-fiber foods.<br>3. Avoid processed sugar.",
                "For Hypertension: ❤️<br>1. Reduce salt intake.<br>2. Practice yoga breathing.<br>3. Sleep at least 7 hrs.",
                "For Asthma: 🌬️<br>1. Avoid smoke/pollution.<br>2. Do breathing exercises.<br>3. Carry inhaler always.",
                "For Arthritis: 🦵<br>1. Do gentle stretches.<br>2. Keep weight healthy.<br>3. Warm compress for relief."
            ],
            "Yoga": [
                "Surya Namaskar 🌞<br>1. Stand straight.<br>2. Raise arms & bend forward.<br>3. Stretch back.<br>4. Step into plank.<br>5. Cobra pose.<br>6. Repeat.",
                "Tree Pose 🌳<br>1. Stand on one leg.<br>2. Place other foot on thigh.<br>3. Join palms.<br>4. Hold for 30 seconds.",
                "Child’s Pose 🧘‍♂️<br>1. Kneel on floor.<br>2. Stretch arms forward.<br>3. Rest forehead down.<br>4. Breathe deeply.",
                "Bridge Pose 🌉<br>1. Lie on back.<br>2. Bend knees, feet flat.<br>3. Lift hips upward.<br>4. Hold for 20 sec."
            ],
            "Meditation": [
                "Breathing Meditation 🌿<br>1. Sit comfortably.<br>2. Close eyes.<br>3. Inhale 4 sec, hold 4 sec, exhale 4 sec.<br>4. Repeat for 5 min.",
                "Mindfulness 🧘<br>1. Sit quietly.<br>2. Focus on breath.<br>3. Notice thoughts without judgment.<br>4. Continue 10 min.",
                "Body Scan Relaxation 🛌<br>1. Lie down.<br>2. Focus from head to toes.<br>3. Relax each part slowly.<br>4. Take deep breaths.",
                "Gratitude Practice 🙏<br>1. Sit quietly.<br>2. Think of 3 things you’re grateful for.<br>3. Smile & breathe deeply."
            ],
            "Nutrition": [
                "Stay hydrated 💧<br>Drink at least 2–3 liters of water daily.",
                "Balanced diet 🍎<br>Eat fruits, veggies, protein & whole grains every day.",
                "Limit junk food 🍔<br>Replace sugary drinks with fresh juices or water.",
                "Eat on time ⏰<br>Have 3 main meals & 2 small snacks regularly."
            ]
        };

        // Pick a random category
        const categoryNames = Object.keys(categories);
        const randomCategory = categoryNames[Math.floor(Math.random() * categoryNames.length)];
        const tips = categories[randomCategory];
        const randomTip = tips[Math.floor(Math.random() * tips.length)];

        // ✅ Use innerHTML so <br> works
        document.getElementById('wellnessTipDisplay').innerHTML = `${randomCategory} Tip:<br><br>${randomTip}`;
    }
}

        // --- Initialize Application ---
        const pageManager = new PageManager();

        // Initialize page instances for global access
        let profilePage, medicationsPage, emergencyPage, appointmentsPage, wellnessPage;

        // Load first sidebar wellness tip
        loadSidebarTip();

        // Theme toggle
        document.getElementById('themeToggle').addEventListener('change', (e) => {
            app.setTheme(e.target.checked);
        });

        // Sidebar navigation
        document.querySelectorAll('.sidebar-item').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                pageManager.loadPage(item.dataset.page);
            });
        });

        // Load initial data and page
        document.addEventListener('DOMContentLoaded', async () => {
            await app.loadData();
            await pageManager.loadPage('chat');
            
            // Load wellness tip in sidebar
            try {
                const tip = await app.getWeatherTip();
                document.getElementById('wellnessTipText').textContent = tip;
            } catch (error) {
                document.getElementById('wellnessTipText').textContent = 
                    "Remember to stay hydrated and maintain a balanced diet for optimal health!";
            }

            // Set initial theme
            const savedTheme = localStorage.getItem('theme') || 'dark';
            app.setTheme(savedTheme === 'dark');
            document.getElementById('themeToggle').checked = savedTheme === 'dark';

            const sidebar = document.getElementById('sidebar');
            const toggleButton = document.getElementById('sidebarToggle');

            toggleButton.addEventListener('click', () => {
            sidebar.classList.toggle('collapsed');
        });

        });

        async function loadSidebarTip() {
            try {
            const response = await fetch("/get_weather_tip");
            const data = await response.json();
            document.getElementById("wellnessTipText").textContent = data.tip;
            } catch (err) {
                console.error("Failed to load tip:", err);
                document.getElementById("wellnessTipText").textContent = "Could not load tip.";
            }
        }

        document.addEventListener("DOMContentLoaded", async () => {
        // Create app state
        window.app = new AppState();

        // Create page manager
        window.pageManager = new PageManager();

        // Load the default page (chat)
        await pageManager.loadPage("chat");

        // Sidebar navigation
        document.querySelectorAll(".sidebar-item").forEach(item => {
        item.addEventListener("click", async (e) => {
            e.preventDefault();
            const pageId = item.getAttribute("data-page");
            await pageManager.loadPage(pageId);
        });
        });

    // Sidebar toggle
    document.getElementById("sidebarToggle").addEventListener("click", () => {
        document.getElementById("sidebar").classList.toggle("collapsed");
        document.querySelector(".main-content").classList.toggle("collapsed");
    });

    // Theme toggle
    const themeToggle = document.getElementById("themeToggle");
    themeToggle.addEventListener("change", (e) => {
        app.setTheme(e.target.checked);
    });

    // Apply saved theme
    const savedTheme = localStorage.getItem("theme");
    app.setTheme(savedTheme === "dark");
    themeToggle.checked = savedTheme === "dark";

    // Load daily wellness tip
    const tip = await app.getWeatherTip();
    document.getElementById("wellnessTipText").textContent = tip;
});
    </script>
</body>
</html>